From c14100b6c0c3f0eae9a88925d62bf3816f92a92b Mon Sep 17 00:00:00 2001
From: Tom Nabarro <tom.nabarro@intel.com>
Date: Fri, 8 Apr 2022 05:37:56 -0400
Subject: [PATCH] debug root port changes

Signed-off-by: Tom Nabarro <tom.nabarro@intel.com>
Change-Id: Ie64f70a1b90317d3a7f044724a0194eca2cafbac
---
 lib/vmd/vmd.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/lib/vmd/vmd.c b/lib/vmd/vmd.c
index c8a0c7906..5535867d3 100644
--- a/lib/vmd/vmd.c
+++ b/lib/vmd/vmd.c
@@ -1125,8 +1125,11 @@ vmd_reset_root_ports(struct vmd_pci_bus *bus)
 			continue;
 		}
 
-		header = (volatile void *)(bus->vmd->cfg_vaddr + CONFIG_OFFSET_ADDR(bus->bus_number,
-					   devfn, 0, 0));
+		header = (volatile void *)(bus->vmd->cfg_vaddr +
+					   CONFIG_OFFSET_ADDR(bus->config_bus_number, devfn, 0, 0));
+		SPDK_ERRLOG("cfg_vaddr=%p bus_number=%d config_bus_number=%d devfn=%d header=%p\n",
+			    bus->vmd->cfg_vaddr, bus->bus_number, bus->config_bus_number, devfn,
+			    header);
 		if (vmd_device_is_root_port(header) && !vmd_device_is_enumerated(header)) {
 			vmd_reset_base_limit_registers(header);
 		}
-- 
2.31.1

